<img src="https://github.com/Kerimniy/Abotrep/blob/main/abotreplogo.png" style="width: 10%">
<p>In english <a href="https://github.com/Kerimniy/Abotrep/blob/main/README.md">click</a></p>

# Abotrep

–õ—ë–≥–∫–∏–π reverse-proxy –Ω–∞ **Axum** (Rust), –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç –∑–∞—â–∏—Ç—É –æ—Ç –∫—Ä–∞—É–ª–µ—Ä–æ–≤ –∏ –ø—Ä–æ—Å—Ç—ã—Ö –±–æ—Ç–æ–≤ –∏ –ø–µ—Ä–µ–≥—Ä—É–∑–æ–∫:

- Rate-Limit –ø–æ IP  
- –ê–Ω—Ç–∏–±–æ—Ç-–ø—Ä–æ–≤–µ—Ä–∫–∏: PoW, CAPTCHA (Cloudflare Turnstile –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏), Custom  
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ `X-Forwarded-For`  
- –ü—Ä–æ–∑—Ä–∞—á–Ω–æ–µ –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π backend  
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ HTTPS (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)  

## üöÄ –ó–∞–ø—É—Å–∫

### 1. –°–±–æ—Ä–∫–∞
```bash
cargo build --release
```

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª (`config.json`)

```json
[
  {
    "url": "http://localhost:8080",                  // –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –±—ç–∫–µ–Ω–¥–∞
    "proxy_host": "0.0.0.0:3000",                    // –Ω–∞ –∫–∞–∫–æ–º –∞–¥—Ä–µ—Å–µ —Å–ª—É—à–∞–µ—Ç –ø—Ä–æ–∫—Å–∏
    "is_blacklist_rate_limit": true,                 // true = blacklist mode (—É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—É—Ç–∏ –ª–∏–º–∏—Ç–∏—Ä—É—é—Ç—Å—è), false = whitelist
    "rate_limit": {
      "/api": { "limit": 10, "window": 5 }           // 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ 5 —Å–µ–∫—É–Ω–¥
    },
    "default_rate_limit": { "limit": 20, "window": 10 },

    "is_blacklist_antibot": false,                   // true = —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—É—Ç–∏ —Ç—Ä–µ–±—É—é—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏
    "antibot": {
      "/login": "CAPTCHA",
      "/register": "PoW"
    },
    "default_antibot": "PoW",

    "is_secure": false,
    "cert_path": "",
    "cert_key_path": ""
  }
]
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ –∫—É–∫–∏

–§–∞–π–ª `.SECRETKEY` (64 —Å–ª—É—á–∞–π–Ω—ã—Ö –±–∞–π—Ç–∞):

```bash
openssl rand -base64 32 > .SECRETKEY
```

### 4. –ó–∞–ø—É—Å–∫

```bash
./target/release/your_binary_name
```

## üìÅ –°—Ç–∞—Ç–∏–∫–∞ –∏ —à–∞–±–ª–æ–Ω—ã

–®–∞–±–ª–æ–Ω—ã –∞–Ω—Ç–∏–±–æ—Ç-—Å—Ç—Ä–∞–Ω–∏—Ü –∏ –æ—à–∏–±–æ–∫ –¥–æ–ª–∂–Ω—ã –ª–µ–∂–∞—Ç—å –≤ –ø–∞–ø–∫–µ `templates/`:

```
templates/
‚îú‚îÄ‚îÄ captcha.html     ‚Üê slider-based simple captcha
‚îú‚îÄ‚îÄ pow.html         ‚Üê Proof-of-Work
‚îú‚îÄ‚îÄ custom.html      ‚Üê –≤–∞—à–∞ –∫–∞—Å—Ç–æ–º–Ω–∞—è CAPTCHA
‚îú‚îÄ‚îÄ 429.html         ‚Üê Too Many Requests
‚îú‚îÄ‚îÄ 500.html         ‚Üê Internal Server Error
‚îú‚îÄ‚îÄ 502.html         ‚Üê Bad Gateway
‚îî‚îÄ‚îÄ 504.html         ‚Üê Gateway Timeout
```

## üß© –¢–∏–ø—ã –∞–Ω—Ç–∏–±–æ—Ç-–∑–∞—â–∏—Ç—ã

### CAPTCHA
- –ß–∏—Ç–∞–µ—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º—ã—à–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

### PoW (Proof-of-Work)
- –ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–¥–∞—á—É: –Ω–∞–π—Ç–∏ SHA256(`token + nonce`) –ø–æ–∫–∞ –ø–µ—Ä–≤—ã–µ **N** –±–∏—Ç –Ω–µ –±—É–¥—É—Ç –Ω—É–ª—è–º–∏.
- –û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è POST ‚Üí `/powver`:
```json
{ "token": "random_str", "nonce": 123456, "bits": 20 }
```

### Custom CAPTCHA
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ –∫–æ–Ω—Ñ–∏–≥–µ:
```json
"antibot": {
  "/somepath": {
    "type": "Custom",
    "verify_url": "https://your-service/verify",
    "secret_key": "supersecret123"
  }
}
```
POST ‚Üí `/tokenver` –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å `secret_key` + —Ç–æ–∫–µ–Ω –æ—Ç –∫–ª–∏–µ–Ω—Ç–∞.

## ‚è≥ Rate Limit

- –£—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–π IP –∫–ª–∏–µ–Ω—Ç–∞ (–¥–∞–∂–µ –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –ø—Ä–æ–∫—Å–∏)
- `limit` ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- `window` ‚Äî –æ–∫–Ω–æ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–µ—Ñ–∏–∫—Å–Ω—ã—Ö –ø—É—Ç–µ–π —á–µ—Ä–µ–∑ Trie (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/api/v1/` –∑–∞—â–∏—Ç–∏—Ç –≤—Å—ë –ø–æ–¥–¥–µ—Ä–µ–≤–æ)

## üîí HTTPS

–ï—Å–ª–∏ `is_secure: true` ‚Äî —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç–∏ –∫ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º:

```json
"cert_path": "/path/to/fullchain.pem",
"cert_key_path": "/path/to/privkey.pem"
```

## üåê –ü—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

–ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏ **–∫—Ä–æ–º–µ**:
- `host`
- `content-length`
- `connection`
- `transfer-encoding`
- `date`
- `content-encoding`

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è:
```
X-Forwarded-For: <client_ip>, <previous_proxy>, ...
```

## üìå Cookie –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∞–Ω—Ç–∏–±–æ—Ç-–ø—Ä–æ–≤–µ—Ä–∫–∏ –≤—ã—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–∞—è –∫—É–∫–∞:

```
checked=1
```

- –°—Ä–æ–∫ –∂–∏–∑–Ω–∏: **36 —á–∞—Å–æ–≤**
- –ü–æ–¥–ø–∏—Å—å: HMAC-SHA256 —Å –∫–ª—é—á–æ–º –∏–∑ `.SECRETKEY`
